{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../../../../services/texber.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@angular/common\";\n\nfunction DomiciliosEntregaComponent_div_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 14);\n    i0.ɵɵlistener(\"click\", function DomiciliosEntregaComponent_div_12_Template_div_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r3);\n      const item_r1 = restoredCtx.$implicit;\n      const ctx_r2 = i0.ɵɵnextContext();\n      return ctx_r2.seleccionarDomicilio(item_r1);\n    });\n    i0.ɵɵelementStart(1, \"div\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const item_r1 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"ngClass\", ctx_r0.domicilioSeleccionado == item_r1 ? \"bg-primary text-light\" : \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r1.razonSocial);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Tipo Domicilio: \", item_r1.tipoDomicilio, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r1.domicilio1);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\"\", item_r1.municipio, \" \", item_r1.nacion, \"\");\n  }\n}\n\nconst _c0 = function () {\n  return [\"../../lliuraments/0\"];\n};\n\nexport let DomiciliosEntregaComponent = /*#__PURE__*/(() => {\n  class DomiciliosEntregaComponent {\n    constructor(fb, texberService, router, route) {\n      this.fb = fb;\n      this.texberService = texberService;\n      this.router = router;\n      this.route = route;\n      this.listaDomicilios = [];\n      this.cliente = {\n        codigoCliente: '',\n        siglaNacion: '',\n        cifDni: '',\n        cifEuropeo: '',\n        codigoProveedor: '',\n        codigoContable: '',\n        codigoCategoriaCliente: '',\n        razonSocial: '',\n        nombre: '',\n        domicilio: '',\n        codigoSigla: '',\n        viaPublica: '',\n        numero1: '',\n        codigoPostal: '',\n        codigoMunicipio: '',\n        municipio: '',\n        codigoProvincia: '',\n        provincia: '',\n        codigoNacion: '',\n        nacion: '',\n        telefono: '',\n        cuentaProvision: '',\n        idCliente: ''\n      };\n      this.domicilioSeleccionado = {\n        tipoDomicilio: '',\n        razonSocial: '',\n        domicilio1: '',\n        municipio: '',\n        nacion: '',\n        idDomicilio: ''\n      };\n      this.cabAlbCli = {\n        serieAlbaran: '',\n        numeroAlbaran: 0,\n        codigoCliente: '',\n        siglaNacion: '',\n        cifDni: '',\n        razonSocial: '',\n        razonSocialEnvios: '',\n        nombre: '',\n        nombreEnvios: '',\n        domicilio: '',\n        domicilioEnvios: '',\n        viaPublicaEnvios: '',\n        codigoPostal: '',\n        codigoPostalEnvios: '',\n        codigoMunicipio: '',\n        codigoMunicipioEnvios: '',\n        municipio: '',\n        municipioEnvios: '',\n        provincia: '',\n        provinciaEnvios: '',\n        codigoNacion: '',\n        codigoNacionEnvios: '',\n        nacion: '',\n        nacionEnvios: '',\n        telefonoEnvios: '',\n        codigoContable: ''\n      };\n      this.linAlbCli = {\n        serieAlbaran: '',\n        numeroAlbaran: 0,\n        orden: 0,\n        codigoArticulo: '',\n        tipoArticulo: '',\n        codigoAlmacen: '',\n        partida: '',\n        descripcionArticulo: '',\n        codigoFamilia: '',\n        codigoIva: 0,\n        unidades: 0,\n        unidades2: 0,\n        precio: 0,\n        precioRebaje: 0,\n        iva: 0,\n        CoBobinas: 0\n      };\n      this.articulos = [];\n      this.arrayLinAlbCli = [];\n      this.valido = false;\n      this.lineasAlbaran = [];\n      this.numAlbaran = 0;\n      this.ordenLinAlbCli = 0;\n      this.codProductos = [];\n      this.codCliente = '';\n      this.enlace = '';\n      this.arrayEtiquetas = [];\n      this.myForm = this.fb.group({\n        serieAlb: ['']\n      });\n    }\n\n    ngOnInit() {\n      this.route.params.subscribe(params => {\n        this.codCliente = params['codCliente'];\n        console.log(this.codCliente);\n      });\n      this.texberService.getClienteByCod(this.codCliente).subscribe(resp => this.cliente = resp);\n      this.texberService.getDomiciliosByCodCliente(this.codCliente).subscribe(resp => this.listaDomicilios = resp);\n      this.lineasAlbaran = this.texberService.obtenerLineasAlbaran();\n      this.articulos = this.texberService.obtenerArticulos();\n      this.myForm.reset();\n    }\n\n    campoCliente() {\n      return this.domicilioSeleccionado == null;\n    }\n\n    seleccionarDomicilio(item) {\n      this.domicilioSeleccionado = item;\n      this.valido = true;\n    }\n\n    generarAlbaran() {\n      this.cabAlbCli = {\n        serieAlbaran: this.myForm.controls['serieAlb'].value,\n        numeroAlbaran: 0,\n        codigoCliente: this.cliente.codigoCliente,\n        siglaNacion: this.cliente.siglaNacion,\n        cifDni: this.cliente.cifDni,\n        razonSocial: this.cliente.razonSocial,\n        razonSocialEnvios: this.cliente.razonSocial,\n        nombre: this.cliente.nombre,\n        nombreEnvios: this.cliente.nombre,\n        domicilio: this.cliente.domicilio,\n        domicilioEnvios: this.cliente.domicilio,\n        viaPublicaEnvios: this.cliente.viaPublica,\n        codigoPostal: this.cliente.codigoPostal,\n        codigoPostalEnvios: this.cliente.codigoPostal,\n        codigoMunicipio: this.cliente.codigoMunicipio,\n        codigoMunicipioEnvios: this.cliente.codigoMunicipio,\n        municipio: this.cliente.municipio,\n        municipioEnvios: this.cliente.municipio,\n        provincia: this.cliente.provincia,\n        provinciaEnvios: this.cliente.provincia,\n        codigoNacion: this.cliente.codigoNacion,\n        codigoNacionEnvios: this.cliente.codigoNacion,\n        nacion: this.cliente.nacion,\n        nacionEnvios: this.cliente.nacion,\n        telefonoEnvios: this.cliente.telefono,\n        codigoContable: this.cliente.codigoContable\n      };\n      this.texberService.postCabAlbCli(this.cabAlbCli).subscribe(resp => {\n        if (resp) {\n          this.generarLinAlbCli(resp);\n        }\n      });\n    }\n\n    generarLinAlbCli(resp) {\n      let arraySplitPartida = [];\n      let etiqueta = {\n        numAlb: '',\n        numBulto: ''\n      };\n\n      for (let i = 0; i < this.lineasAlbaran.length; i++) {\n        this.linAlbCli.serieAlbaran = this.myForm.controls['serieAlb'].value, this.linAlbCli.numeroAlbaran = resp, this.linAlbCli.orden = 0, this.linAlbCli.codigoArticulo = this.lineasAlbaran[i].codProducto, this.linAlbCli.tipoArticulo = this.articulos[i].tipoArticulo, this.linAlbCli.codigoAlmacen = this.lineasAlbaran[i].codigoAlmacen, this.linAlbCli.partida = this.lineasAlbaran[i].partida, this.linAlbCli.descripcionArticulo = this.articulos[i].descripcionArticulo, this.linAlbCli.codigoFamilia = this.articulos[i].codigoFamilia, this.linAlbCli.codigoIva = 18, this.linAlbCli.unidades = this.lineasAlbaran[i].peso, this.linAlbCli.unidades2 = this.lineasAlbaran[i].peso, this.linAlbCli.precio = this.articulos[i].precioVenta, this.linAlbCli.precioRebaje = this.articulos[i].precioVenta, this.linAlbCli.iva = 18.0, this.linAlbCli.CoBobinas = this.lineasAlbaran[i].CoBobinas;\n        this.arrayLinAlbCli.push(this.linAlbCli);\n        arraySplitPartida = this.lineasAlbaran[i].partida.split(' ');\n        etiqueta.numAlb = resp.toString();\n        etiqueta.numBulto = arraySplitPartida[1];\n        this.arrayEtiquetas.push(etiqueta);\n        arraySplitPartida = [];\n        etiqueta = {\n          numAlb: '',\n          numBulto: ''\n        };\n        this.linAlbCli = {\n          serieAlbaran: '',\n          numeroAlbaran: 0,\n          orden: 0,\n          codigoArticulo: '',\n          tipoArticulo: '',\n          codigoAlmacen: '',\n          partida: '',\n          descripcionArticulo: '',\n          codigoFamilia: '',\n          codigoIva: 0,\n          unidades: 0,\n          unidades2: 0,\n          precio: 0,\n          precioRebaje: 0,\n          iva: 0,\n          CoBobinas: 0\n        };\n      }\n\n      this.texberService.postLinAlbCli(this.arrayLinAlbCli).subscribe(resp => {\n        if (resp.length > 0) {\n          for (let i = 0; i < resp.length; i++) {\n            let a = document.createElement(\"a\");\n            a.href = resp[i];\n            a.download = \"etiqueta-\" + this.arrayEtiquetas[i].numAlb + '-' + this.arrayEtiquetas[i].numBulto + '.pdf';\n            a.click();\n          }\n\n          this.numAlbaran = 0;\n          this.ordenLinAlbCli = 0;\n          this.myForm.reset();\n          this.router.navigate(['/texber/lliuraments/lliuraments/1']);\n        }\n      });\n    }\n\n  }\n\n  DomiciliosEntregaComponent.ɵfac = function DomiciliosEntregaComponent_Factory(t) {\n    return new (t || DomiciliosEntregaComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.TexberService), i0.ɵɵdirectiveInject(i3.Router), i0.ɵɵdirectiveInject(i3.ActivatedRoute));\n  };\n\n  DomiciliosEntregaComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: DomiciliosEntregaComponent,\n    selectors: [[\"app-domicilios-entrega\"]],\n    decls: 18,\n    vars: 5,\n    consts: [[1, \"container\", \"mx-auto\", \"mt-5\"], [1, \"col-md-6\", \"mt-2\", \"mx-auto\", 2, \"height\", \"85vh\"], [1, \"my-5\"], [3, \"formGroup\"], [1, \"form-group\", \"d-flex\"], [1, \"col-4\", \"col-form-label\"], [\"type\", \"text\", \"formControlName\", \"serieAlb\", 1, \"form-control\"], [1, \"mt-5\", \"mb-2\", \"overflow-auto\", 2, \"height\", \"80%\"], [\"class\", \"border border-primary rounded text-primary mb-3 px-3\", 3, \"ngClass\", \"click\", 4, \"ngFor\", \"ngForOf\"], [1, \"d-flex\", \"justify-content-between\"], [1, \"btn\", \"btn-transparent\", \"text-success\", \"fs-1\", \"fw-bold\", 3, \"disabled\", \"click\"], [1, \"bi\", \"bi-check-circle\"], [1, \"btn\", \"btn-transparent\", \"text-danger\", \"fs-1\", \"fw-bold\", 3, \"routerLink\"], [1, \"bi\", \"bi-x-circle\"], [1, \"border\", \"border-primary\", \"rounded\", \"text-primary\", \"mb-3\", \"px-3\", 3, \"ngClass\", \"click\"]],\n    template: function DomiciliosEntregaComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\")(3, \"h2\", 2);\n        i0.ɵɵtext(4, \"Domicilis Enviament\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(5, \"div\")(6, \"form\", 3)(7, \"div\", 4)(8, \"label\", 5);\n        i0.ɵɵtext(9, \"S\\u00E8rie Albar\\u00E0:\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(10, \"input\", 6);\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(11, \"div\", 7);\n        i0.ɵɵtemplate(12, DomiciliosEntregaComponent_div_12_Template, 9, 6, \"div\", 8);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(13, \"div\", 9)(14, \"button\", 10);\n        i0.ɵɵlistener(\"click\", function DomiciliosEntregaComponent_Template_button_click_14_listener() {\n          return ctx.generarAlbaran();\n        });\n        i0.ɵɵelement(15, \"i\", 11);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"button\", 12);\n        i0.ɵɵelement(17, \"i\", 13);\n        i0.ɵɵelementEnd()()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"formGroup\", ctx.myForm);\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"ngForOf\", ctx.listaDomicilios);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"disabled\", !ctx.valido);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(4, _c0));\n      }\n    },\n    directives: [i1.ɵNgNoValidate, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.DefaultValueAccessor, i1.NgControlStatus, i1.FormControlName, i4.NgForOf, i4.NgClass, i3.RouterLink],\n    encapsulation: 2\n  });\n  return DomiciliosEntregaComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}